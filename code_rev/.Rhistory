DF <- merge(DF, grouping[,c("ID","GROUP")],by="ID")
DF <- na.omit(DF)
model = lme(anthro ~ factor(GROUP) + age + race + education + preBMI + GA_blood + Gender + nulli + alcohol + post,
data = DF, random = ~1 | pairID, weights = varFixed(~v))
pval[i] <- Anova(model,type=2)[[3]][1]
}
traj_bwz <- data.frame(met_ID= substring(lipid_id,4), pval = pval, pBonf = p.adjust(pval,"bonferroni"), pFDR = p.adjust(pval,"fdr"))
traj_bwz <- inner_join(anno, traj_bw, by = "met_ID")
bwz0 <- read.csv("../tmp/bwz0.csv", header=T, sep=",")
bwz1 <- read.csv("../tmp/bwz1.csv", header=T, sep=",")
bwz2 <- read.csv("../tmp/bwz2.csv", header=T, sep=",")
bwz4 <- read.csv("../tmp/bwz4.csv", header=T, sep=",")
bwz_merge <- inner_join(inner_join(inner_join(inner_join(bwz0[,c("Annotation", "met_ID","beta","pval","pBonf","pFDR")],
bwz1[,c("met_ID","beta","pval","pBonf","pFDR")], by="met_ID"),
bwz2[,c("met_ID","beta","pval","pBonf","pFDR")], by="met_ID"),
bwz4[,c("met_ID","beta","pval","pBonf","pFDR")], by="met_ID"),
traj_bwz[,c("met_ID","pval","pBonf","pFDR")])
names(bwz_merge)[c(3:18)] <- paste0(rep(c("beta","pval","pBonf","pFDR"),4),rep(c(0,1,2,4),each=4))
names(bwz_merge)[19:21] <- paste0(c("pval","pBonf","pFDR"),"_traj")
bwz_merge$Ann. <- substring(bwz_merge$Annotation,1,3)
bwz_merge$significance <- (bwz_merge$pFDR0<0.05) + (bwz_merge$pFDR1<0.05) + (bwz_merge$pFDR2<0.05) + (bwz_merge$pFDR4<0.05)
ggplot(bwz_merge, aes(x=met_ID, y= -log10(pval0), group=factor(Ann.))) +
geom_point(aes(col = Ann.)) +
geom_hline(aes(yintercept = -log10(0.05/328)))
ggplot(bwz_merge, aes(x=met_ID, y= -log10(pval0), group=factor(Ann.))) +
geom_point(aes(col = Ann.)) +
geom_hline(aes(yintercept = -log10(0.05/328)))+
ggtitles("Visit 0")
ggplot(bwz_merge, aes(x=met_ID, y= -log10(pval0), group=factor(Ann.))) +
geom_point(aes(col = Ann.)) +
geom_hline(aes(yintercept = -log10(0.05/328)))+
ggtitle("Visit 0")
ggplot(bwz_merge, aes(x=met_ID, y= -log10(pval1), group=factor(Ann.))) +
geom_point(aes(col = Ann.)) +
geom_hline(aes(yintercept = -log10(0.05/328)))+
ggtitle("Visit 1")
ggplot(bwz_merge, aes(x=met_ID, y= -log10(pval2), group=factor(Ann.))) +
geom_point(aes(col = Ann.)) +
geom_hline(aes(yintercept = -log10(0.05/328)))+
ggtitle("Visit 2")
ggplot(bwz_merge, aes(x=met_ID, y= -log10(pval4), group=factor(Ann.))) +
geom_point(aes(col = Ann.)) +
geom_hline(aes(yintercept = -log10(0.05/328)))+
ggtitle("Visit 4")
ggplot(bwz_merge, aes(x=met_ID, y= -log10(pval_traj), group=factor(Ann.))) +
geom_point(aes(col = Ann.)) +
geom_hline(aes(yintercept = -log10(0.05/328)))
addmargins(table(bw_merge$Ann.,bw_merge$pFDR0 < 0.05),1)
addmargins(table(bwz_merge$Ann.,bw_merge$pFDR0 < 0.05),1)
addmargins(table(bwz_merge$Ann.,bw_merge$pFDR1 < 0.05),1)
addmargins(table(bwz_merge$Ann.,bw_merge$pFDR2 < 0.05),1)
traj_bwz <- data.frame(met_ID= substring(lipid_id,4), pval = pval, pBonf = p.adjust(pval,"bonferroni"), pFDR = p.adjust(pval,"fdr"))
traj_bwz <- inner_join(anno, traj_bwz, by = "met_ID")
ggplot(bwz_merge, aes(x=met_ID, y= -log10(pval_traj), group=factor(Ann.))) +
geom_point(aes(col = Ann.)) +
geom_hline(aes(yintercept = -log10(0.05/328)))
bwz0 <- read.csv("../tmp/bwz0.csv", header=T, sep=",")
bwz1 <- read.csv("../tmp/bwz1.csv", header=T, sep=",")
bwz2 <- read.csv("../tmp/bwz2.csv", header=T, sep=",")
bwz4 <- read.csv("../tmp/bwz4.csv", header=T, sep=",")
bwz_merge <- inner_join(inner_join(inner_join(inner_join(bwz0[,c("Annotation", "met_ID","beta","pval","pBonf","pFDR")],
bwz1[,c("met_ID","beta","pval","pBonf","pFDR")], by="met_ID"),
bwz2[,c("met_ID","beta","pval","pBonf","pFDR")], by="met_ID"),
bwz4[,c("met_ID","beta","pval","pBonf","pFDR")], by="met_ID"),
traj_bwz[,c("met_ID","pval","pBonf","pFDR")])
names(bwz_merge)[c(3:18)] <- paste0(rep(c("beta","pval","pBonf","pFDR"),4),rep(c(0,1,2,4),each=4))
names(bwz_merge)[19:21] <- paste0(c("pval","pBonf","pFDR"),"_traj")
bwz_merge$Ann. <- substring(bwz_merge$Annotation,1,3)
bwz_merge$significance <- (bwz_merge$pFDR0<0.05) + (bwz_merge$pFDR1<0.05) + (bwz_merge$pFDR2<0.05) + (bwz_merge$pFDR4<0.05)
ggplot(bwz_merge, aes(x=met_ID, y= -log10(pval_traj), group=factor(Ann.))) +
geom_point(aes(col = Ann.)) +
geom_hline(aes(yintercept = -log10(0.05/328)))
addmargins(table(bwz_merge$Ann.,bwz_merge$pFDR0 < 0.05),1)
addmargins(table(bwz_merge$Ann.,bwz_merge$pFDR1 < 0.05),1)
addmargins(table(bwz_merge$Ann.,bwz_merge$pFDR2 < 0.05),1)
addmargins(table(bwz_merge$Ann.,bwz_merge$pFDR4 < 0.05),1)
addmargins(table(bwz_merge$Ann.,bwz_merge$significance),1)
addmargins(table(bwz_merge$Ann.,bwz_merge$pFDR_traj < 0.05),1)
bwz_merge %>% filter(pFDR0 < 0.05) %>% ggplot(aes(x=beta0,y=met_ID,group = factor(Ann.))) +
geom_point(aes(col=factor(Ann.))) + geom_vline(xintercept = 0) +
scale_y_discrete(breaks=NULL) + ggtitle("Visit 0") +
labs(col = "Annotation")
bwz_merge %>% filter(pFDR1 < 0.05) %>% ggplot(aes(x=beta1,y=met_ID,group = factor(Ann.))) +
geom_point(aes(col=factor(Ann.))) + geom_vline(xintercept = 0) +
scale_y_discrete(breaks=NULL) + ggtitle("Visit 1") +
labs(col = "Annotation")
bwz_merge %>% filter(pFDR2 < 0.05) %>% ggplot(aes(x=beta2,y=met_ID,group = factor(Ann.))) +
geom_point(aes(col=factor(Ann.))) + geom_vline(xintercept = 0) +
scale_y_discrete(breaks=NULL) + ggtitle("Visit 2") +
labs(col = "Annotation")
bwz_merge %>% filter(pFDR4 < 0.05) %>% ggplot(aes(x=beta4,y=met_ID,group = factor(Ann.))) +
geom_point(aes(col=factor(Ann.))) + geom_vline(xintercept = 0) +
scale_y_discrete(breaks=NULL) + ggtitle("Visit 4") +
labs(col = "Annotation")
setwd("C:/past research/ABC_wu/Manuscript/revision/new code")
i = 7
i = 1
nmc = 25
metric = "median"
data <- readMat(paste0('../Result/werngren_v1/',bacName[i],'.mat'))
simu = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'.mat'))
simu1 = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1.mat'))
simu1a <- readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1a.mat'))
bacName = c("H37Rv", "E865", "E729", "E740", "E1221", "E1449", "Harlingen",
"E26_95", "E80", "E55", "E26_94", "E3942", "E47")
library(R.matlab)
library(flexclust)
data <- readMat(paste0('../Result/werngren_v1/',bacName[i],'.mat'))
simu = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'.mat'))
simu1 = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1.mat'))
simu1a <- readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1a.mat'))
#
X_t = data$X.t; N_t = rep(data$N.t,length(X_t))
df = rbind(cbind(X_t,N_t), cbind(simu$Xt, simu$Nt))
ratio_data <- X_t/N_t
ratio_simu <- simu$Xt/simu$Nt
ratio_simu1 <- simu1$Xt/simu1$Nt
ratio_simu1a <- simu1a$Xt/simu1a$Nt
dist_ratio
dist_ratio <- dist2(ratio_data, ratio_simu)
dist_ratio1 <- dist2(ratio_data, ratio_simu1)
dist_ratio1a <- dist2(ratio_data, ratio_simu1a)
ratio_data
ratio_simu
ratio_simu1
ratio_simu1a
dist_ratio
dist_ratio1
dist_ratio1a
mean(dist_ratio1)
assign(paste0("ratio_",metric,"_1"),mean(dist_ratio1))
assign(paste0("ratio_",metric,"_1a"),mean(dist_ratio1a))
assign(paste0("ratio_",metric),mean(dist_ratio))
assign(paste0("p_ratio_",metric,"_1a_1"),wilcox.test(dist_ratio1a,dist_ratio1,alternative = "less")$p.value)
assign(paste0("p_ratio_",metric,"_2_1"),wilcox.test(dist_ratio,dist_ratio1, alternative = "less")$p.value)
assign(paste0("p_ratio_",metric,"_2_1a"),wilcox.test(dist_ratio,dist_ratio1a, alternative = "less")$p.value)
# res1[,i] <- signif(c(mat_mean_1,mat_median_1,ratio_mean_1,
#                        ratio_median_1,ratios_mean_1,ratios_median_1),3)
# res1a[,i] <- signif(c(mat_mean_1a,p_mat_mean_1a,mat_median_1a,p_mat_median_1a,
#                       ratio_mean_1a, p_ratio_mean_1a, ratio_median_1a, p_ratio_median_1a,
#                       ratios_mean_1a, p_ratios_mean_1a, ratios_median_1a, p_ratios_median_1a),3)
# res[,i] <- signif(c(mat_mean,p_mat_mean,mat_median,p_mat_median,
#                     ratio_mean, p_ratio_mean, ratio_median, p_ratio_median,
#                     ratios_mean, p_ratios_mean, ratios_median, p_ratios_median),3)
res1[,i] <- signif(c(ratio_mean_1,ratio_median_1),3)
res1a[,i] <- signif(c(ratio_mean_1a, ratio_median_1a),3)
res[,i] <- signif(c(ratio_mean, ratio_median),3)
for(metric in c("mean","median")){
data <- readMat(paste0('../Result/werngren_v1/',bacName[i],'.mat'))
simu = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'.mat'))
simu1 = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1.mat'))
simu1a <- readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1a.mat'))
#
X_t = data$X.t; N_t = rep(data$N.t,length(X_t))
df = rbind(cbind(X_t,N_t), cbind(simu$Xt, simu$Nt))
#df.scaled = scale(df)
#dist_mat = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat)
#min(dist_mat)
#mean(dist_mat)
#colMeans(df[1:length(X_t),])
#colMeans(df[-(1:length(X_t)),])
#sum((colMeans(df.scaled[1:length(X_t),]) - colMeans(df.scaled[-(1:length(X_t)),]))^2)
#df = rbind(cbind(X_t,N_t), cbind(simu1$Xt, simu1$Nt))
#df.scaled = scale(df)
#dist_mat1 = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat1)
#min(dist_mat1)
#mean(dist_mat1)
#df = rbind(cbind(X_t,N_t), cbind(simu1a$Xt, simu1a$Nt))
#df.scaled = scale(df)
#dist_mat1a = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat1a)
#min(dist_mat1a)
#mean(dist_mat1a)
#ratio_scaled = scale(c(X_t/N_t, simu$Xt/simu$Nt))
#dist_ratio_scaled <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#ratio_scaled = scale(c(X_t/N_t, simu1$Xt/simu1$Nt))
#dist_ratio_scaled_1 <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#ratio_scaled = scale(c(X_t/N_t, simu1a$Xt/simu1a$Nt))
#dist_ratio_scaled_1a <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#min(dist_ratio_scaled)
#max(dist_ratio_scaled)
#mean(dist_ratio_scaled)
#(mean(ratio_scaled[1:length(X_t)]) - mean(ratio_scaled[-(1:length(X_t))]))^2
ratio_data <- X_t/N_t
ratio_simu <- simu$Xt/simu$Nt
ratio_simu1 <- simu1$Xt/simu1$Nt
ratio_simu1a <- simu1a$Xt/simu1a$Nt
dist_ratio <- dist2(ratio_data, ratio_simu)
dist_ratio1 <- dist2(ratio_data, ratio_simu1)
dist_ratio1a <- dist2(ratio_data, ratio_simu1a)
#t.test(dist_ratio, dist_ratio1a)
#t.test(dist_ratio1a, dist_ratio1)
#assign(paste0("mat_",metric,"_1"),mean(dist_mat1))
#assign(paste0("mat_",metric,"_1a"),mean(dist_mat1a))
#assign(paste0("mat_",metric),mean(dist_mat))
#assign(paste0("p_mat_",metric,"_1a"),wilcox.test(dist_mat1a,dist_mat1)$p.value)
#assign(paste0("p_mat_",metric),wilcox.test(dist_mat,dist_mat1a)$p.value)
assign(paste0("ratio_",metric,"_1"),mean(dist_ratio1))
assign(paste0("ratio_",metric,"_1a"),mean(dist_ratio1a))
assign(paste0("ratio_",metric),mean(dist_ratio))
assign(paste0("p_ratio_",metric,"_1a_1"),wilcox.test(dist_ratio1a,dist_ratio1,alternative = "less")$p.value)
assign(paste0("p_ratio_",metric,"_2_1"),wilcox.test(dist_ratio,dist_ratio1, alternative = "less")$p.value)
assign(paste0("p_ratio_",metric,"_2_1a"),wilcox.test(dist_ratio,dist_ratio1a, alternative = "less")$p.value)
#assign(paste0("ratios_",metric,"_1"),mean(dist_ratio_scaled_1))
#assign(paste0("ratios_",metric,"_1a"),mean(dist_ratio_scaled_1a))
#assign(paste0("ratios_",metric),mean(dist_ratio_scaled))
#assign(paste0("p_ratios_",metric,"_1a"),wilcox.test(dist_ratio_scaled_1a,dist_ratio_scaled_1)$p.value)
#assign(paste0("p_ratios_",metric),wilcox.test(dist_ratio_scaled,dist_ratio_scaled_1a)$p.value)
}
# res1[,i] <- signif(c(mat_mean_1,mat_median_1,ratio_mean_1,
#                        ratio_median_1,ratios_mean_1,ratios_median_1),3)
# res1a[,i] <- signif(c(mat_mean_1a,p_mat_mean_1a,mat_median_1a,p_mat_median_1a,
#                       ratio_mean_1a, p_ratio_mean_1a, ratio_median_1a, p_ratio_median_1a,
#                       ratios_mean_1a, p_ratios_mean_1a, ratios_median_1a, p_ratios_median_1a),3)
# res[,i] <- signif(c(mat_mean,p_mat_mean,mat_median,p_mat_median,
#                     ratio_mean, p_ratio_mean, ratio_median, p_ratio_median,
#                     ratios_mean, p_ratios_mean, ratios_median, p_ratios_median),3)
res1[,i] <- signif(c(ratio_mean_1,ratio_median_1),3)
res1a[,i] <- signif(c(ratio_mean_1a, ratio_median_1a),3)
res1 <- matrix(NA,2,13)
res1a <- res <- matrix(NA,2,13)
p_res <- matrix(NA,6,13)
# res1[,i] <- signif(c(mat_mean_1,mat_median_1,ratio_mean_1,
#                        ratio_median_1,ratios_mean_1,ratios_median_1),3)
# res1a[,i] <- signif(c(mat_mean_1a,p_mat_mean_1a,mat_median_1a,p_mat_median_1a,
#                       ratio_mean_1a, p_ratio_mean_1a, ratio_median_1a, p_ratio_median_1a,
#                       ratios_mean_1a, p_ratios_mean_1a, ratios_median_1a, p_ratios_median_1a),3)
# res[,i] <- signif(c(mat_mean,p_mat_mean,mat_median,p_mat_median,
#                     ratio_mean, p_ratio_mean, ratio_median, p_ratio_median,
#                     ratios_mean, p_ratios_mean, ratios_median, p_ratios_median),3)
res1[,i] <- signif(c(ratio_mean_1,ratio_median_1),3)
res1a[,i] <- signif(c(ratio_mean_1a, ratio_median_1a),3)
res[,i] <- signif(c(ratio_mean, ratio_median),3)
p_res[,i] <- signif(c(p_ratio_mean_1a_1, p_ratio_mean_2_1a,p_ratio_mean_2_1,
p_ratio_median_1a_1, p_ratio_median_2_1a, p_ratio_median_2_1),3)
rbind(res1[1,],res1a[1,],res[1,],
p_res[1:3,]
)
i
i = 7
for(metric in c("mean","median")){
data <- readMat(paste0('../Result/werngren_v1/',bacName[i],'.mat'))
simu = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'.mat'))
simu1 = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1.mat'))
simu1a <- readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1a.mat'))
#
X_t = data$X.t; N_t = rep(data$N.t,length(X_t))
df = rbind(cbind(X_t,N_t), cbind(simu$Xt, simu$Nt))
#df.scaled = scale(df)
#dist_mat = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat)
#min(dist_mat)
#mean(dist_mat)
#colMeans(df[1:length(X_t),])
#colMeans(df[-(1:length(X_t)),])
#sum((colMeans(df.scaled[1:length(X_t),]) - colMeans(df.scaled[-(1:length(X_t)),]))^2)
#df = rbind(cbind(X_t,N_t), cbind(simu1$Xt, simu1$Nt))
#df.scaled = scale(df)
#dist_mat1 = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat1)
#min(dist_mat1)
#mean(dist_mat1)
#df = rbind(cbind(X_t,N_t), cbind(simu1a$Xt, simu1a$Nt))
#df.scaled = scale(df)
#dist_mat1a = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat1a)
#min(dist_mat1a)
#mean(dist_mat1a)
#ratio_scaled = scale(c(X_t/N_t, simu$Xt/simu$Nt))
#dist_ratio_scaled <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#ratio_scaled = scale(c(X_t/N_t, simu1$Xt/simu1$Nt))
#dist_ratio_scaled_1 <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#ratio_scaled = scale(c(X_t/N_t, simu1a$Xt/simu1a$Nt))
#dist_ratio_scaled_1a <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#min(dist_ratio_scaled)
#max(dist_ratio_scaled)
#mean(dist_ratio_scaled)
#(mean(ratio_scaled[1:length(X_t)]) - mean(ratio_scaled[-(1:length(X_t))]))^2
ratio_data <- X_t/N_t
ratio_simu <- simu$Xt/simu$Nt
ratio_simu1 <- simu1$Xt/simu1$Nt
ratio_simu1a <- simu1a$Xt/simu1a$Nt
dist_ratio <- dist2(ratio_data, ratio_simu)
dist_ratio1 <- dist2(ratio_data, ratio_simu1)
dist_ratio1a <- dist2(ratio_data, ratio_simu1a)
#t.test(dist_ratio, dist_ratio1a)
#t.test(dist_ratio1a, dist_ratio1)
#assign(paste0("mat_",metric,"_1"),mean(dist_mat1))
#assign(paste0("mat_",metric,"_1a"),mean(dist_mat1a))
#assign(paste0("mat_",metric),mean(dist_mat))
#assign(paste0("p_mat_",metric,"_1a"),wilcox.test(dist_mat1a,dist_mat1)$p.value)
#assign(paste0("p_mat_",metric),wilcox.test(dist_mat,dist_mat1a)$p.value)
assign(paste0("ratio_",metric,"_1"),mean(dist_ratio1))
assign(paste0("ratio_",metric,"_1a"),mean(dist_ratio1a))
assign(paste0("ratio_",metric),mean(dist_ratio))
assign(paste0("p_ratio_",metric,"_1a_1"),wilcox.test(dist_ratio1a,dist_ratio1,alternative = "less")$p.value)
assign(paste0("p_ratio_",metric,"_2_1"),wilcox.test(dist_ratio,dist_ratio1, alternative = "less")$p.value)
assign(paste0("p_ratio_",metric,"_2_1a"),wilcox.test(dist_ratio,dist_ratio1a, alternative = "less")$p.value)
#assign(paste0("ratios_",metric,"_1"),mean(dist_ratio_scaled_1))
#assign(paste0("ratios_",metric,"_1a"),mean(dist_ratio_scaled_1a))
#assign(paste0("ratios_",metric),mean(dist_ratio_scaled))
#assign(paste0("p_ratios_",metric,"_1a"),wilcox.test(dist_ratio_scaled_1a,dist_ratio_scaled_1)$p.value)
#assign(paste0("p_ratios_",metric),wilcox.test(dist_ratio_scaled,dist_ratio_scaled_1a)$p.value)
}
# res1[,i] <- signif(c(mat_mean_1,mat_median_1,ratio_mean_1,
#                        ratio_median_1,ratios_mean_1,ratios_median_1),3)
# res1a[,i] <- signif(c(mat_mean_1a,p_mat_mean_1a,mat_median_1a,p_mat_median_1a,
#                       ratio_mean_1a, p_ratio_mean_1a, ratio_median_1a, p_ratio_median_1a,
#                       ratios_mean_1a, p_ratios_mean_1a, ratios_median_1a, p_ratios_median_1a),3)
# res[,i] <- signif(c(mat_mean,p_mat_mean,mat_median,p_mat_median,
#                     ratio_mean, p_ratio_mean, ratio_median, p_ratio_median,
#                     ratios_mean, p_ratios_mean, ratios_median, p_ratios_median),3)
res1[,i] <- signif(c(ratio_mean_1,ratio_median_1),3)
res1a[,i] <- signif(c(ratio_mean_1a, ratio_median_1a),3)
res[,i] <- signif(c(ratio_mean, ratio_median),3)
p_res[,i] <- signif(c(p_ratio_mean_1a_1, p_ratio_mean_2_1a,p_ratio_mean_2_1,
p_ratio_median_1a_1, p_ratio_median_2_1a, p_ratio_median_2_1),3)
rbind(res1[1,],res1a[1,],res[1,],
p_res[1:3,]
)
for(i in 1:13){
for(metric in c("mean","median")){
data <- readMat(paste0('../Result/werngren_v1/',bacName[i],'.mat'))
simu = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'.mat'))
simu1 = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1.mat'))
simu1a <- readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1a.mat'))
#
X_t = data$X.t; N_t = rep(data$N.t,length(X_t))
df = rbind(cbind(X_t,N_t), cbind(simu$Xt, simu$Nt))
#df.scaled = scale(df)
#dist_mat = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat)
#min(dist_mat)
#mean(dist_mat)
#colMeans(df[1:length(X_t),])
#colMeans(df[-(1:length(X_t)),])
#sum((colMeans(df.scaled[1:length(X_t),]) - colMeans(df.scaled[-(1:length(X_t)),]))^2)
#df = rbind(cbind(X_t,N_t), cbind(simu1$Xt, simu1$Nt))
#df.scaled = scale(df)
#dist_mat1 = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat1)
#min(dist_mat1)
#mean(dist_mat1)
#df = rbind(cbind(X_t,N_t), cbind(simu1a$Xt, simu1a$Nt))
#df.scaled = scale(df)
#dist_mat1a = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat1a)
#min(dist_mat1a)
#mean(dist_mat1a)
#ratio_scaled = scale(c(X_t/N_t, simu$Xt/simu$Nt))
#dist_ratio_scaled <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#ratio_scaled = scale(c(X_t/N_t, simu1$Xt/simu1$Nt))
#dist_ratio_scaled_1 <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#ratio_scaled = scale(c(X_t/N_t, simu1a$Xt/simu1a$Nt))
#dist_ratio_scaled_1a <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#min(dist_ratio_scaled)
#max(dist_ratio_scaled)
#mean(dist_ratio_scaled)
#(mean(ratio_scaled[1:length(X_t)]) - mean(ratio_scaled[-(1:length(X_t))]))^2
ratio_data <- X_t/N_t
ratio_simu <- simu$Xt/simu$Nt
ratio_simu1 <- simu1$Xt/simu1$Nt
ratio_simu1a <- simu1a$Xt/simu1a$Nt
dist_ratio <- dist2(ratio_data, ratio_simu)
dist_ratio1 <- dist2(ratio_data, ratio_simu1)
dist_ratio1a <- dist2(ratio_data, ratio_simu1a)
#t.test(dist_ratio, dist_ratio1a)
#t.test(dist_ratio1a, dist_ratio1)
#assign(paste0("mat_",metric,"_1"),mean(dist_mat1))
#assign(paste0("mat_",metric,"_1a"),mean(dist_mat1a))
#assign(paste0("mat_",metric),mean(dist_mat))
#assign(paste0("p_mat_",metric,"_1a"),wilcox.test(dist_mat1a,dist_mat1)$p.value)
#assign(paste0("p_mat_",metric),wilcox.test(dist_mat,dist_mat1a)$p.value)
assign(paste0("ratio_",metric,"_1"),mean(dist_ratio1))
assign(paste0("ratio_",metric,"_1a"),mean(dist_ratio1a))
assign(paste0("ratio_",metric),mean(dist_ratio))
assign(paste0("p_ratio_",metric,"_1a_1"),wilcox.test(dist_ratio1a,dist_ratio1,alternative = "less")$p.value)
assign(paste0("p_ratio_",metric,"_2_1"),wilcox.test(dist_ratio,dist_ratio1, alternative = "less")$p.value)
assign(paste0("p_ratio_",metric,"_2_1a"),wilcox.test(dist_ratio,dist_ratio1a, alternative = "less")$p.value)
#assign(paste0("ratios_",metric,"_1"),mean(dist_ratio_scaled_1))
#assign(paste0("ratios_",metric,"_1a"),mean(dist_ratio_scaled_1a))
#assign(paste0("ratios_",metric),mean(dist_ratio_scaled))
#assign(paste0("p_ratios_",metric,"_1a"),wilcox.test(dist_ratio_scaled_1a,dist_ratio_scaled_1)$p.value)
#assign(paste0("p_ratios_",metric),wilcox.test(dist_ratio_scaled,dist_ratio_scaled_1a)$p.value)
}
# res1[,i] <- signif(c(mat_mean_1,mat_median_1,ratio_mean_1,
#                        ratio_median_1,ratios_mean_1,ratios_median_1),3)
# res1a[,i] <- signif(c(mat_mean_1a,p_mat_mean_1a,mat_median_1a,p_mat_median_1a,
#                       ratio_mean_1a, p_ratio_mean_1a, ratio_median_1a, p_ratio_median_1a,
#                       ratios_mean_1a, p_ratios_mean_1a, ratios_median_1a, p_ratios_median_1a),3)
# res[,i] <- signif(c(mat_mean,p_mat_mean,mat_median,p_mat_median,
#                     ratio_mean, p_ratio_mean, ratio_median, p_ratio_median,
#                     ratios_mean, p_ratios_mean, ratios_median, p_ratios_median),3)
res1[,i] <- signif(c(ratio_mean_1,ratio_median_1),3)
res1a[,i] <- signif(c(ratio_mean_1a, ratio_median_1a),3)
res[,i] <- signif(c(ratio_mean, ratio_median),3)
p_res[,i] <- signif(c(p_ratio_mean_1a_1, p_ratio_mean_2_1a,p_ratio_mean_2_1,
p_ratio_median_1a_1, p_ratio_median_2_1a, p_ratio_median_2_1),3)
}
rbind(res1[1,],res1a[1,],res[1,],
p_res[1:3,])
rbind(res1[2,],res1a[2,],res[2,],
p_res[4:6,])
for(i in 1:13){
for(metric in c("mean","median")){
data <- readMat(paste0('../Result/werngren_v1/',bacName[i],'.mat'))
simu = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'.mat'))
simu1 = readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1.mat'))
simu1a <- readMat(paste0('../Result/model selection/simu_nmc',nmc,'_',metric,'_',
bacName[i],'_m1a.mat'))
#
X_t = data$X.t; N_t = rep(data$N.t,length(X_t))
df = rbind(cbind(X_t,N_t), cbind(simu$Xt, simu$Nt))
#df.scaled = scale(df)
#dist_mat = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat)
#min(dist_mat)
#mean(dist_mat)
#colMeans(df[1:length(X_t),])
#colMeans(df[-(1:length(X_t)),])
#sum((colMeans(df.scaled[1:length(X_t),]) - colMeans(df.scaled[-(1:length(X_t)),]))^2)
#df = rbind(cbind(X_t,N_t), cbind(simu1$Xt, simu1$Nt))
#df.scaled = scale(df)
#dist_mat1 = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat1)
#min(dist_mat1)
#mean(dist_mat1)
#df = rbind(cbind(X_t,N_t), cbind(simu1a$Xt, simu1a$Nt))
#df.scaled = scale(df)
#dist_mat1a = dist2(df.scaled[1:length(X_t),], df.scaled[-(1:length(X_t)),])
#max(dist_mat1a)
#min(dist_mat1a)
#mean(dist_mat1a)
#ratio_scaled = scale(c(X_t/N_t, simu$Xt/simu$Nt))
#dist_ratio_scaled <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#ratio_scaled = scale(c(X_t/N_t, simu1$Xt/simu1$Nt))
#dist_ratio_scaled_1 <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#ratio_scaled = scale(c(X_t/N_t, simu1a$Xt/simu1a$Nt))
#dist_ratio_scaled_1a <- dist2(ratio_scaled[1:length(X_t)],ratio_scaled[-(1:length(X_t))])
#min(dist_ratio_scaled)
#max(dist_ratio_scaled)
#mean(dist_ratio_scaled)
#(mean(ratio_scaled[1:length(X_t)]) - mean(ratio_scaled[-(1:length(X_t))]))^2
ratio_data <- X_t/N_t
ratio_simu <- simu$Xt/simu$Nt
ratio_simu1 <- simu1$Xt/simu1$Nt
ratio_simu1a <- simu1a$Xt/simu1a$Nt
dist_ratio <- dist2(ratio_data, ratio_simu)
dist_ratio1 <- dist2(ratio_data, ratio_simu1)
dist_ratio1a <- dist2(ratio_data, ratio_simu1a)
#t.test(dist_ratio, dist_ratio1a)
#t.test(dist_ratio1a, dist_ratio1)
#assign(paste0("mat_",metric,"_1"),mean(dist_mat1))
#assign(paste0("mat_",metric,"_1a"),mean(dist_mat1a))
#assign(paste0("mat_",metric),mean(dist_mat))
#assign(paste0("p_mat_",metric,"_1a"),wilcox.test(dist_mat1a,dist_mat1)$p.value)
#assign(paste0("p_mat_",metric),wilcox.test(dist_mat,dist_mat1a)$p.value)
assign(paste0("ratio_",metric,"_1"),median(dist_ratio1))
assign(paste0("ratio_",metric,"_1a"),median(dist_ratio1a))
assign(paste0("ratio_",metric),median(dist_ratio))
assign(paste0("p_ratio_",metric,"_1a_1"),wilcox.test(dist_ratio1a,dist_ratio1,alternative = "less")$p.value)
assign(paste0("p_ratio_",metric,"_2_1"),wilcox.test(dist_ratio,dist_ratio1, alternative = "less")$p.value)
assign(paste0("p_ratio_",metric,"_2_1a"),wilcox.test(dist_ratio,dist_ratio1a, alternative = "less")$p.value)
#assign(paste0("ratios_",metric,"_1"),mean(dist_ratio_scaled_1))
#assign(paste0("ratios_",metric,"_1a"),mean(dist_ratio_scaled_1a))
#assign(paste0("ratios_",metric),mean(dist_ratio_scaled))
#assign(paste0("p_ratios_",metric,"_1a"),wilcox.test(dist_ratio_scaled_1a,dist_ratio_scaled_1)$p.value)
#assign(paste0("p_ratios_",metric),wilcox.test(dist_ratio_scaled,dist_ratio_scaled_1a)$p.value)
}
# res1[,i] <- signif(c(mat_mean_1,mat_median_1,ratio_mean_1,
#                        ratio_median_1,ratios_mean_1,ratios_median_1),3)
# res1a[,i] <- signif(c(mat_mean_1a,p_mat_mean_1a,mat_median_1a,p_mat_median_1a,
#                       ratio_mean_1a, p_ratio_mean_1a, ratio_median_1a, p_ratio_median_1a,
#                       ratios_mean_1a, p_ratios_mean_1a, ratios_median_1a, p_ratios_median_1a),3)
# res[,i] <- signif(c(mat_mean,p_mat_mean,mat_median,p_mat_median,
#                     ratio_mean, p_ratio_mean, ratio_median, p_ratio_median,
#                     ratios_mean, p_ratios_mean, ratios_median, p_ratios_median),3)
res1[,i] <- signif(c(ratio_mean_1,ratio_median_1),3)
res1a[,i] <- signif(c(ratio_mean_1a, ratio_median_1a),3)
res[,i] <- signif(c(ratio_mean, ratio_median),3)
p_res[,i] <- signif(c(p_ratio_mean_1a_1, p_ratio_mean_2_1a,p_ratio_mean_2_1,
p_ratio_median_1a_1, p_ratio_median_2_1a, p_ratio_median_2_1),3)
}
rbind(res1[2,],res1a[2,],res[2,],
p_res[4:6,])
write.csv(rbind(res1[1,],res1a[1,],res[1,],
p_res[1:3,]),
file = "../Result/model selection/model_selection_meanRatio_nmc25_medianDist.csv",
row.names =F)
write.csv(rbind(res1[2,],res1a[2,],res[2,],
p_res[4:6,]),
file = "../Result/model selection/model_selection_medianRatio_nmc25_medianDist.csv",
row.names =F)
